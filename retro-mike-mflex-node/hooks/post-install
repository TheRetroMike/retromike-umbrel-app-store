#!/usr/bin/env bash
set -euo pipefail

MC_APP_DIR="/home/umbrel/umbrel/app-data/retro-mike-miningcore"
POOL_MGR="${MC_APP_DIR}/scripts/pool-manager.sh"

if [[ ! -x "${POOL_MGR}" ]]; then
  echo "[mflex-node] Miningcore pool-manager not found at ${POOL_MGR} (is Miningcore installed?)" >&2
  exit 0
fi

sudo "${POOL_MGR}" register-bitcoin \
  --pool-id "mflex" \
  --coin "multiflex" \
  --app-id "retro-mike-mflex-node" \
  --rpc-port "9010" \
  --zmq-port "7010" \
  --stratum-port "6010" \
  --daemon-host "retro-mike-mflex-node_node_1" \
  --address-type "bechsegwit" \
  --mflex-enabled
